from github import Github

# Replace with your GitHub personal access token
GITHUB_TOKEN = 'your_personal_access_token_here'

# Replace with your GitHub organization name and new team name
ORG_NAME = 'your_github_org_name'
NEW_TEAM_NAME = 'New Consolidated Team'

# Initialize GitHub API client
g = Github(GITHUB_TOKEN)

# Get the organization object
org = g.get_organization(ORG_NAME)

# Create or get the new team where all members will be copied
new_team = None
for team in org.get_teams():
    if team.name == NEW_TEAM_NAME:
        new_team = team
        break

if not new_team:
    new_team = org.create_team(name=NEW_TEAM_NAME, privacy='closed')
    print(f"Created new team: {NEW_TEAM_NAME}")

# Set to keep track of unique members (to avoid duplicates)
unique_members = set()

# Loop through all teams in the organization (excluding the new team itself)
for team in org.get_teams():
    if team.name != NEW_TEAM_NAME:
        print(f"Processing team: {team.name}")

        # Add each member of the current team to the set
        for member in team.get_members():
            unique_members.add(member.login)

# Add each unique member to the new consolidated team
for member_login in unique_members:
    user = g.get_user(member_login)
    new_team.add_membership(user)
    print(f"Added {member_login} to {NEW_TEAM_NAME}")

print("All team members copied to the new team successfully.")
